<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flash Royale</title>
  <style>
    body {
      margin:0; font-family:Arial, sans-serif;
      color:white; user-select:none;
      background:url('castle-bg.png') no-repeat center center fixed;
      background-size:cover;
    }
    /* --- Top HUD Bar --- */
    .top-bar {
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 20px; background:rgba(10,15,30,0.9);
      border-bottom:3px solid #1e3d59; font-size:14px;
    }
    .level { display:flex; align-items:center; gap:10px; }
    .level-bar {
      background:#222; border-radius:6px; width:120px; height:10px;
      overflow:hidden; border:1px solid #555;
    }
    .level-fill { background:#4cc9f0; height:100%; width:70%; }
    .currency { display:flex; gap:15px; }
    .currency div {
      background:#2d3e50; padding:5px 12px; border-radius:8px;
      display:flex; align-items:center; gap:5px;
    }
    .currency img { width:16px; height:16px; }

    /* --- Tabs (Bottom Nav) --- */
    .tabs {
      position:fixed; bottom:0; left:0; width:100%;
      display:flex; justify-content:space-around;
      background:rgba(10,15,30,0.95); border-top:3px solid #1e3d59;
      padding:10px 0;
    }
    .tab { text-align:center; flex:1; cursor:pointer; font-size:14px; padding:5px; }
    .tab img { width:28px; display:block; margin:auto; }
    .tab:hover { background:#1e3d59; }

    /* --- Screens --- */
    .screen { display:none; padding:20px; text-align:center; }
    #battleScreen .battle-btn {
      background:#ffcc00; padding:20px 40px; border-radius:12px;
      font-size:24px; color:black; cursor:pointer; margin-top:20px;
      border:3px solid #fff; box-shadow:0 0 15px rgba(255,255,0,0.6);
    }

    /* --- Deck + Collection --- */
    #deckScreen .deck, #collection {
      display:grid; grid-template-columns:repeat(4,1fr);
      gap:10px; margin-bottom:20px;
    }
    .card {
      position:relative; border-radius:12px; overflow:hidden;
      text-align:center; font-size:12px; cursor:pointer;
      background:linear-gradient(to bottom,#333,#111);
      border:3px solid #888; box-shadow:0 3px 8px rgba(0,0,0,0.6);
      padding:5px; transition:transform 0.15s;
    }
    .card:hover { transform:scale(1.05); }
    .card img { width:80%; margin:5px auto; }
    .elixir-cost {
      position:absolute; top:5px; left:5px;
      background:#9c27b0; border-radius:50%;
      width:28px; height:28px; display:flex; align-items:center; justify-content:center;
      font-size:14px; font-weight:bold; border:2px solid white;
    }
    .rarity-common { border-color:#aaa; }
    .rarity-rare { border-color:#2196f3; }
    .rarity-epic { border-color:#9c27b0; }
    .rarity-legendary { border-color:#ff9800; }

    /* --- Chest Bar --- */
    .chest-bar {
      display:flex; justify-content:center; gap:10px;
      margin-top:20px;
    }
    .chest { width:60px; }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
</head>
<body>

  <!-- Top HUD -->
  <div class="top-bar">
    <div class="level">
      <div>üëë Lvl 11</div>
      <div class="level-bar"><div class="level-fill"></div></div>
    </div>
    <div class="currency">
      <div><img src="https://img.icons8.com/emoji/48/000000/coin-emoji.png"/> 145,881</div>
      <div><img src="https://img.icons8.com/color/48/000000/emerald.png"/> 828</div>
    </div>
  </div>

  <!-- Screens -->
  <div id="battleScreen" class="screen" style="display:block;">
    <h2>üèÜ Flash Royale</h2>
    <p>Your trophies: <b>4698</b></p>

    <!-- Room Join UI -->
    <div>
      <input id="roomInput" placeholder="Enter Room Name" style="padding:8px;border-radius:6px;border:none;">
      <button class="battle-btn" onclick="joinRoom()">Join/Create Room</button>
    </div>

    <div id="roomStatus"></div>

    <!-- Start Battle Button (shows once 2 players join) -->
    <div id="startBtn" class="battle-btn" style="display:none;" onclick="startBattle()">START BATTLE</div>

    <div class="chest-bar">
      <img src="https://img.icons8.com/color/96/treasure-chest.png" class="chest"/>
      <img src="https://img.icons8.com/color/96/treasure-chest.png" class="chest"/>
      <img src="https://img.icons8.com/color/96/treasure-chest.png" class="chest"/>
    </div>
  </div>

  <div id="deckScreen" class="screen">
    <h2>üÉè Your Deck</h2>
    <div class="deck" id="deck"></div>
    <h3>Average Elixir: <span id="avgElixir">0</span></h3>
    <h2>üìñ Collection</h2>
    <div class="deck" id="collection"></div>
  </div>

  <div id="clanScreen" class="screen">
    <h2>üë• Clans (Coming Soon)</h2>
  </div>

  <div id="leaderScreen" class="screen">
    <h2>üèÖ Leaderboards (Coming Soon)</h2>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab" onclick="switchScreen('deckScreen')">
      <img src="https://img.icons8.com/ios/50/ffffff/cards.png"/>Collection
    </div>
    <div class="tab" onclick="switchScreen('battleScreen')">
      <img src="https://img.icons8.com/ios/50/ffffff/swords.png"/>Battle
    </div>
    <div class="tab" onclick="switchScreen('clanScreen')">
      <img src="https://img.icons8.com/ios/50/ffffff/group.png"/>Clan
    </div>
    <div class="tab" onclick="switchScreen('leaderScreen')">
      <img src="https://img.icons8.com/ios/50/ffffff/trophy.png"/>Leaderboard
    </div>
  </div>

  <script>
    // --- Firebase Init ---
    const firebaseConfig = {
      apiKey: "AIzaSyA3FUH9RZiQ9IRChNpGqNrgjt2r5AA5RF8",
      authDomain: "flash-royale-a92c0.firebaseapp.com",
      databaseURL: "https://flash-royale-a92c0-default-rtdb.firebaseio.com",
      projectId: "flash-royale-a92c0",
      storageBucket: "flash-royale-a92c0.firebasestorage.app",
      messagingSenderId: "703977930640",
      appId: "1:703977930640:web:a4f70deb5bbe508aec7d15",
      measurementId: "G-61B7P6WEL0"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- Game Vars ---
    let cards = [
      {name:"Blade Knight", cost:3, rarity:"common", img:"https://img.icons8.com/color/96/knight.png"},
      {name:"Storm Archer", cost:3, rarity:"rare", img:"https://img.icons8.com/color/96/bow.png"},
      {name:"Inferno Drake", cost:5, rarity:"epic", img:"https://img.icons8.com/color/96/dragon.png"},
      {name:"Rock Golem", cost:4, rarity:"common", img:"https://img.icons8.com/color/96/rock.png"},
      {name:"Shadow Rogue", cost:2, rarity:"rare", img:"https://img.icons8.com/color/96/ninja-head.png"},
      {name:"Frost Mage", cost:4, rarity:"epic", img:"https://img.icons8.com/color/96/magic-wand.png"},
      {name:"Fire Bomb", cost:4, rarity:"epic", img:"https://img.icons8.com/color/96/bomb.png"},
      {name:"Lightning Bolt", cost:6, rarity:"legendary", img:"https://img.icons8.com/color/96/lightning-bolt.png"}
    ];
    let deck = [...cards]; 
    let selectedSlot = null;
    let roomId = null;
    let playerId = "player-" + Math.floor(Math.random()*10000);

    // --- UI Switcher ---
    function switchScreen(id){
      document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
      document.getElementById(id).style.display='block';
    }

    // --- Deck Builder ---
    function renderCards(){
      const deckEl=document.getElementById("deck");
      const colEl=document.getElementById("collection");
      deckEl.innerHTML=""; colEl.innerHTML="";
      deck.forEach((c,i)=>{
        let d=document.createElement("div");
        d.className="card rarity-"+c.rarity;
        d.innerHTML=`<div class="elixir-cost">${c.cost}</div><img src="${c.img}"><b>${c.name}</b>`;
        d.onclick=()=>{ selectedSlot=i; alert("Selected deck slot "+(i+1)+". Now click a collection card to replace it."); };
        deckEl.appendChild(d);
      });
      cards.forEach(c=>{
        let d=document.createElement("div");
        d.className="card rarity-"+c.rarity;
        d.innerHTML=`<div class="elixir-cost">${c.cost}</div><img src="${c.img}"><b>${c.name}</b>`;
        d.onclick=()=>{ if(selectedSlot!==null){ deck[selectedSlot]=c; selectedSlot=null; saveDeck(); renderCards(); } };
        colEl.appendChild(d);
      });
      document.getElementById("avgElixir").innerText=
        (deck.reduce((a,b)=>a+b.cost,0)/deck.length).toFixed(1);
    }

    function saveDeck(){
      if(roomId){
        db.ref(`rooms/${roomId}/players/${playerId}/deck`).set(deck);
      }
    }

    // --- Room Join/Create ---
    function joinRoom(){
      roomId = document.getElementById("roomInput").value.trim();
      if(!roomId){ alert("Enter a room name!"); return; }
      db.ref(`rooms/${roomId}/players/${playerId}`).set({joined:true});
      document.getElementById("roomStatus").innerText = "Joined room: "+roomId+" as "+playerId;
      // Watch for number of players
      db.ref(`rooms/${roomId}/players`).on("value",(snap)=>{
        let players = snap.val();
        if(players && Object.keys(players).length>=2){
          document.getElementById("startBtn").style.display="block";
        }
      });
    }

    // --- Battle Sync ---
    function startBattle(){
      alert("Battle starting in room "+roomId+"!");
      db.ref(`rooms/${roomId}/lastAction`).on("value",(snap)=>{
        let action=snap.val();
        if(action && action.player!==playerId){
          alert("Opponent played: "+action.card.name);
        }
      });
      document.addEventListener("keydown",(e)=>{
        if(e.key==="p"){
          let c=deck[Math.floor(Math.random()*deck.length)];
          sendAction(c);
        }
      });
    }

    function sendAction(card){
      db.ref(`rooms/${roomId}/lastAction`).set({
        type:"playCard", card, player:playerId, timestamp:Date.now()
      });
      alert("You played: "+card.name);
    }

    renderCards();
  </script>
</body>
</html>
