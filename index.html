<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flash Royale</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#000 url('dark-castle.png') no-repeat center center fixed; background-size:cover; color:white; user-select:none; }
    .top-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:rgba(10,15,30,0.9);border-bottom:3px solid #1e3d59;font-size:14px;}
    .level{display:flex;align-items:center;gap:10px;}
    .level-bar{background:#222;border-radius:6px;width:120px;height:10px;overflow:hidden;border:1px solid #555;}
    .level-fill{background:#4cc9f0;height:100%;width:70%;}
    .currency{display:flex;gap:15px;}
    .currency div{background:#2d3e50;padding:5px 12px;border-radius:8px;display:flex;align-items:center;gap:5px;}
    .currency img{width:16px;height:16px;}
    .screen{display:none;padding:20px;}
    #menuScreen{display:block;text-align:center;}
    .battle-btn{background:#ffcc00;padding:20px 60px;border-radius:20px;font-size:32px;color:black;cursor:pointer;margin-top:20px;border:3px solid #fff;box-shadow:0 0 25px rgba(255,255,0,0.9);}
    .cancel-btn{background:#ff4444;padding:15px 40px;border-radius:15px;font-size:24px;color:white;cursor:pointer;margin-top:20px;border:3px solid #fff;box-shadow:0 0 20px rgba(255,0,0,0.7);display:none;}
    .deck,#collection,#shop{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:20px auto;max-width:400px;}
    .card{position:relative;border-radius:12px;overflow:hidden;text-align:center;font-size:12px;cursor:pointer;background:linear-gradient(to bottom,#333,#111);border:3px solid #888;box-shadow:0 3px 8px rgba(0,0,0,0.6);padding:5px;}
    .card img{width:70%;margin:5px auto;}
    .card.selected{border:3px solid cyan;box-shadow:0 0 15px cyan;}
    .elixir-cost{position:absolute;top:5px;left:5px;background:#9c27b0;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:bold;border:2px solid white;}
    .tabs{position:fixed;bottom:0;left:0;width:100%;display:flex;justify-content:space-around;background:rgba(10,15,30,0.95);border-top:3px solid #1e3d59;padding:10px 0;}
    .tab{text-align:center;flex:1;cursor:pointer;font-size:14px;padding:5px;}
    .tab img{width:28px;display:block;margin:auto;}
    .tab:hover{background:#1e3d59;}
    #battleCanvas{background:rgba(0,0,0,0.6);border:3px solid white;margin-top:20px;}
    #cardBar{position:fixed;bottom:70px;left:50%;transform:translateX(-50%);display:flex;gap:10px;display:none;}
    #elixirBar{position:fixed;bottom:50px;left:50%;transform:translateX(-50%);width:300px;height:20px;border:2px solid white;border-radius:10px;background:#222;display:none;}
    #elixirFill{background:purple;width:0%;height:100%;border-radius:10px;}
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
  <!-- Top HUD -->
  <div class="top-bar">
    <div class="level"><div>üëë Lvl <span id="level">1</span></div><div class="level-bar"><div class="level-fill"></div></div></div>
    <div class="currency">
      <div><img src="https://img.icons8.com/emoji/48/000000/coin-emoji.png"/> <span id="coinCount">0</span></div>
      <div><img src="https://img.icons8.com/color/48/000000/emerald.png"/> 0</div>
    </div>
    <div id="statusText">Idle</div>
  </div>

  <!-- Menu Screen -->
  <div id="menuScreen" class="screen" style="display:block;">
    <h2>üèÜ Flash Royale</h2>
    <p>Your trophies: <b id="trophies">0</b></p>
    <button id="battleBtn" class="battle-btn" onclick="findMatch()">BATTLE</button>
    <button id="cancelBtn" class="cancel-btn" onclick="cancelSearch()">Cancel</button>
    <h2>Your Deck</h2><div class="deck" id="deck"></div>
    <h2>Card Collection</h2><div id="collection"></div>
    <h2>Shop</h2><div id="shop"></div>
  </div>

  <!-- Battle Screen -->
  <div id="battleScreen" class="screen" style="display:none;">
    <canvas id="battleCanvas" width="800" height="700"></canvas>
  </div>
  <div id="cardBar"></div>
  <div id="elixirBar"><div id="elixirFill"></div></div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab" onclick="switchScreen('menuScreen')"><img src="https://img.icons8.com/ios/50/ffffff/cards.png"/>Cards</div>
    <div class="tab" onclick="switchScreen('menuScreen')"><img src="https://img.icons8.com/ios/50/ffffff/swords.png"/>Battle</div>
    <div class="tab" onclick="switchScreen('menuScreen')"><img src="https://img.icons8.com/ios/50/ffffff/shopping-cart.png"/>Shop</div>
  </div>

  <script>
    // --- Firebase Init ---
    const firebaseConfig={apiKey:"AIzaSyA3FUH9RZiQ9IRChNpGqNrgjt2r5AA5RF8",authDomain:"flash-royale-a92c0.firebaseapp.com",databaseURL:"https://flash-royale-a92c0-default-rtdb.firebaseio.com",projectId:"flash-royale-a92c0",storageBucket:"flash-royale-a92c0.appspot.com",messagingSenderId:"703977930640",appId:"1:703977930640:web:a4f70deb5bbe508aec7d15",measurementId:"G-61B7P6WEL0"};
    firebase.initializeApp(firebaseConfig);
    const db=firebase.database();

    // --- Player Profile ---
    let playerId=localStorage.getItem("playerId");
    if(!playerId){playerId="player-"+Math.floor(Math.random()*10000);localStorage.setItem("playerId",playerId);}
    let coins=0,trophies=0,ownedCards=["Knight"];

    const playerRef=db.ref("players/"+playerId);
    playerRef.once("value").then(snap=>{
      if(!snap.exists()){
        playerRef.set({coins:0,trophies:0,ownedCards:["Knight"]});
      }
    });

    // Sync
    playerRef.on("value",snap=>{
      if(snap.exists()){
        let data=snap.val();
        coins=data.coins||0;
        trophies=data.trophies||0;
        ownedCards=data.ownedCards||["Knight"];
        updateCoinsDisplay(coins);
        document.getElementById("trophies").innerText=trophies;
        renderDeck();renderCollection();renderShop();
      }
    });

    function updateCoinsDisplay(val){document.getElementById("coinCount").innerText=val;}

    // --- Cards & Shop ---
    let allCards=[
      {name:"Knight",hp:200,dmg:20,range:20,cost:3,img:"https://img.icons8.com/color/96/knight.png",price:0},
      {name:"Archer",hp:120,dmg:15,range:120,cost:3,img:"https://img.icons8.com/color/96/bow.png",price:150},
      {name:"Golem",hp:300,dmg:10,range:30,cost:5,img:"https://img.icons8.com/color/96/rock.png",price:200},
      {name:"Dragon",hp:150,dmg:30,range:80,cost:4,img:"https://img.icons8.com/color/96/dragon.png",price:300}
    ];

    function renderDeck(){
      let deckEl=document.getElementById("deck");
      deckEl.innerHTML="";
      ownedCards.forEach(cn=>{
        let c=allCards.find(x=>x.name===cn);
        if(c){
          let d=document.createElement("div");
          d.className="card";
          d.innerHTML=`<div class="elixir-cost">${c.cost}</div><img src="${c.img}"><b>${c.name}</b>`;
          deckEl.appendChild(d);
        }
      });
    }

    function renderCollection(){
      let col=document.getElementById("collection");
      col.innerHTML="";
      ownedCards.forEach(cn=>{
        let c=allCards.find(x=>x.name===cn);
        if(c){
          let d=document.createElement("div");
          d.className="card";
          d.innerHTML=`<div class="elixir-cost">${c.cost}</div><img src="${c.img}"><b>${c.name}</b>`;
          col.appendChild(d);
        }
      });
    }

    function renderShop(){
      let shop=document.getElementById("shop");
      shop.innerHTML="";
      allCards.forEach(c=>{
        if(!ownedCards.includes(c.name) && c.price>0){
          let d=document.createElement("div");
          d.className="card";
          d.innerHTML=`<img src="${c.img}"><b>${c.name}</b><br>üí∞ ${c.price}`;
          d.onclick=()=>{
            if(coins>=c.price){
              coins-=c.price;
              ownedCards.push(c.name);
              playerRef.update({coins:coins,ownedCards:ownedCards});
            }
          };
          shop.appendChild(d);
        }
      });
    }

    // --- Rewards (when game ends) ---
    function rewardWinner(){
      coins+=100;
      trophies+=5;
      playerRef.update({coins:coins,trophies:trophies});
    }

    // --- Battlefield Placement ---
    let selectedCard=null;
    let placementCircle=null;
    const canvas=document.getElementById("battleCanvas");
    const ctx=canvas.getContext("2d");

    canvas.addEventListener("mousemove",e=>{
      if(selectedCard){
        let rect=e.target.getBoundingClientRect();
        let x=e.clientX-rect.left;
        let y=e.clientY-rect.top;
        if(y<350){placementCircle=null;}
        else{placementCircle={x,y};}
        drawBattle();
      }
    });

    canvas.addEventListener("click",e=>{
      if(selectedCard && placementCircle){
        let lane=(placementCircle.x<325)?"top":(placementCircle.x<475)?"mid":"bot";
        console.log("Placed",selectedCard.name,"in",lane);
        selectedCard=null;placementCircle=null;
        drawBattle();
      }
    });

    function drawBattle(){
      ctx.clearRect(0,0,800,700);
      if(placementCircle){
        ctx.strokeStyle="white";
        ctx.beginPath();
        ctx.arc(placementCircle.x,placementCircle.y,25,0,Math.PI*2);
        ctx.stroke();
      }
    }

    function switchScreen(id){
      document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
      document.getElementById(id).style.display='block';
    }
  </script>
</body>
</html>
